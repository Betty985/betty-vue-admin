var re=Object.defineProperty,se=Object.defineProperties;var ne=Object.getOwnPropertyDescriptors;var S=Object.getOwnPropertySymbols;var ie=Object.prototype.hasOwnProperty,de=Object.prototype.propertyIsEnumerable;var q=(p,s,m)=>s in p?re(p,s,{enumerable:!0,configurable:!0,writable:!0,value:m}):p[s]=m,$=(p,s)=>{for(var m in s||(s={}))ie.call(s,m)&&q(p,m,s[m]);if(S)for(var m of S(s))de.call(s,m)&&q(p,m,s[m]);return p},U=(p,s)=>se(p,ne(s));import{d as me,B as y,A as C,z as ce,l as pe,r as h,D as fe,o as g,m as O,s as w,x as o,a as n,w as l,G as B,c as v,J as T,F as _e,n as he,q as c,t as Fe}from"./vendor.df9bfe02.js";import{u as P}from"./index.48e608ee.js";const ge={class:"role-manage"},ye={class:"query-form"},Ce=c("\u67E5\u8BE2"),De=c("\u91CD\u7F6E"),ke={class:"base-table"},ve={class:"action"},be=c("\u521B\u5EFA"),we=c("\u7F16\u8F91"),Be=c("\u8BBE\u7F6E\u6743\u9650"),Ee=c("\u5220\u9664"),Ne={class:"dialog-footer"},$e=c("\u53D6\u6D88"),Ve=c("\u786E\u5B9A"),xe={class:"dialog-footer"},Le=c("\u53D6\u6D88"),Te=c("\u786E\u5B9A"),Ae=me({setup(p){const s=y({pageNum:1,pageSize:5});let m=C([]),z=y([]),V=y({}),K=C(""),x=C("\u83DC\u5355"),R=C(""),I=C(""),F=C(!1),_=C(!1),D=y({}),J=y([{label:"\u89D2\u8272\u540D\u79F0",prop:"roleName"},{label:"\u5907\u6CE8",prop:"remark"},{label:"\u6743\u9650\u5217\u8868",prop:"permissList",width:200,formatter(e,t,i){let d=i.halfCheckedKeys||[],a=[];return d.map(f=>{let k=V[f];f&&k&&a.push(k)}),a.join(",")}},{label:"\u66F4\u65B0\u65F6\u95F4",prop:"updateTime",formatter(e,t,i){return P.formateDate(new Date(i))}},{label:"\u521B\u5EFA\u65F6\u95F4",prop:"createTime",formatter(e,t,i){return P.formateDate(new Date(i))}}]),E=y({});const{proxy:r}=ce(),j=y({roleName:[{required:!0,message:"\u8BF7\u8F93\u5165\u89D2\u8272\u540D\u79F0"}]});async function G(){try{let e=await r.$api.getMenuList();z=e,te(e)}catch(e){throw new Error(e)}}async function N(){try{let{page:e,list:t}=await r.$api.getRoleList($($({},E),s));m.value=t,s.total=e.total}catch(e){throw new Error(e)}}pe(()=>{N(),G()});function L(e){r.$refs[e].resetFields()}function H(){x.value="\u521B\u5EFA\u89D2\u8272",K.value="create",F.value=!0}function Q(e){x.value="\u7F16\u8F91\u89D2\u8272",F.value=!0,K.value="edit",r.$nextTick(()=>{D={_id:e._id,roleName:e.roleName,remark:e.remark}})}async function W(e){await r.$api.roleOperate({id:e,action:"delete"}),r.$message.success("\u5220\u9664\u6210\u529F"),N()}function X(){r.$refs.dialogForm.validate(async e=>{if(e){let{action:t,roleForm:i}=r,d=U($({},i),{action:t});await r.$api.roleOperate(d)&&(F.value=!1,r.$message.success("\u64CD\u4F5C\u6210\u529F"),L(r.$refs.dialogForm),r.$api.getRoleList())}})}function Y(){F.value=!1,L("dialogForm")}function Z(e){_.value=!0,I.value=e._id,R.value=e.roleName;let{checkedKeys:t}=e.permissionList;setTimeout(()=>{r.$refs.permissionTree.setCheckedKeys(t)})}async function ee(){let e=r.$refs.permissionTree.getCheckedNodes(),t=r.$refs.permissionTree.getHalfcheckedKeys(),i=[],d=[];e.map(f=>{f.children?d.push(f._id):i.push(f._id)});let a={_id:r.curRoleId,permissionList:{checkedKeys:i,halfcheckedKeys:d.concat(t)}};await r.$api.updatePermission(a),_.value=!1,r.$message.success("\u8BBE\u7F6E\u6210\u529F"),r.getMenuList()}function te(e){let t={};const i=d=>{for(let a of d)a.children&&a.action&&(V[a._id]=a.menuName),a.children&&!a.action&&i(a.children)};i(JSON.parse(JSON.stringify(e))),V=t}function le(e){s.pageNum=e,N()}return(e,t)=>{const i=h("el-input"),d=h("el-form-item"),a=h("el-button"),f=h("el-form"),k=h("el-table-column"),ae=h("el-table"),oe=h("el-pagination"),A=h("el-dialog"),ue=h("el-tree"),b=fe("has");return g(),O("div",ge,[w("div",ye,[o(f,{inline:!0,ref:"form",model:n(E)},{default:l(()=>[o(d,{label:"\u89D2\u8272\u540D\u79F0",prop:"roleName"},{default:l(()=>[o(i,{modelValue:n(E).roleName,"onUpdate:modelValue":t[0]||(t[0]=u=>n(E).roleName=u),placeholder:"\u8BF7\u8F93\u5165\u89D2\u8272\u540D\u79F0"},null,8,["modelValue"])]),_:1}),o(d,null,{default:l(()=>[B((g(),v(a,{type:"primary",onClick:N},{default:l(()=>[Ce]),_:1})),[[b,"role-query"]]),o(a,{onClick:t[1]||(t[1]=u=>L("form"))},{default:l(()=>[De]),_:1})]),_:1})]),_:1},8,["model"])]),w("div",ke,[w("div",ve,[B((g(),v(a,{type:"primary",onClick:H},{default:l(()=>[be]),_:1})),[[b,"role.create"]])]),o(ae,{data:n(m)},{default:l(()=>[o(k,{type:"selection",width:"55"}),(g(!0),O(_e,null,he(n(J),u=>(g(),v(k,{key:u.prop,prop:u.prop,label:u.label,formatter:u.formatter,width:u.width},null,8,["prop","label","formatter","width"]))),128)),o(k,{label:"\u64CD\u4F5C",width:"220"},{default:l(u=>[B((g(),v(a,{onClick:M=>Q(u.row),size:"small",type:"primary"},{default:l(()=>[we]),_:2},1032,["onClick"])),[[b,"role-edit"]]),B((g(),v(a,{onClick:M=>Z(u.row),size:"small"},{default:l(()=>[Be]),_:2},1032,["onClick"])),[[b,"role-permission"]]),B((g(),v(a,{type:"danger",onClick:M=>W(u.row._id),size:"small"},{default:l(()=>[Ee]),_:2},1032,["onClick"])),[[b,"role-delete"]])]),_:1})]),_:1},8,["data"]),o(oe,{class:"pagination",background:"",layout:"prev, pager, next",total:n(s).total,"page-size":n(s).pageSize,onCurrentChange:le},null,8,["total","page-size"])]),o(A,{title:n(x),modelValue:n(F),"onUpdate:modelValue":t[4]||(t[4]=u=>T(F)?F.value=u:F=u)},{footer:l(()=>[w("span",Ne,[o(a,{onClick:Y},{default:l(()=>[$e]),_:1}),o(a,{type:"primary",onClick:X},{default:l(()=>[Ve]),_:1})])]),default:l(()=>[o(f,{ref:"dialogForm",model:n(D),"label-width":"100px",rules:n(j)},{default:l(()=>[o(d,{label:"\u89D2\u8272\u540D\u79F0",prop:"roleName"},{default:l(()=>[o(i,{modelValue:n(D).roleName,"onUpdate:modelValue":t[2]||(t[2]=u=>n(D).roleName=u),placeholder:"\u8BF7\u8F93\u5165\u89D2\u8272\u540D\u79F0"},null,8,["modelValue"])]),_:1}),o(d,{label:"\u5907\u6CE8",prop:"remark"},{default:l(()=>[o(i,{type:"textarea",rows:2,modelValue:n(D).remark,"onUpdate:modelValue":t[3]||(t[3]=u=>n(D).remark=u),placeholder:"\u8BF7\u8F93\u5165\u89D2\u8272\u5907\u6CE8"},null,8,["modelValue"])]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["title","modelValue"]),o(A,{title:"\u6743\u9650\u8BBE\u7F6E",modelValue:n(_),"onUpdate:modelValue":t[6]||(t[6]=u=>T(_)?_.value=u:_=u)},{footer:l(()=>[w("span",xe,[o(a,{onClick:t[5]||(t[5]=u=>T(_)?_.value=!1:_=!1)},{default:l(()=>[Le]),_:1}),o(a,{type:"primary",onClick:ee},{default:l(()=>[Te]),_:1})])]),default:l(()=>[o(f,{"label-width":"100px"},{default:l(()=>[o(d,{label:"\u89D2\u8272\u540D\u79F0"},{default:l(()=>[c(Fe(n(R)),1)]),_:1}),o(d,{label:"\u9009\u62E9\u6743\u9650"},{default:l(()=>[o(ue,{ref:"permissionTree",data:n(z),"show-checkbox":"","node-key":"_id",props:{label:"menuName"},"default-expand-all":""},null,8,["data"])]),_:1})]),_:1})]),_:1},8,["modelValue"])])}}});export{Ae as default};
